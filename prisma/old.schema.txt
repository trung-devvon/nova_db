generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activities {
  id                                  String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  subject                             String          @db.VarChar(255)
  description                         String?
  activity_type                       activity_type
  related_to_type                     String?         @db.VarChar(50)
  related_to_id                       String?         @db.Uuid
  owner_id                            String          @db.Uuid
  assigned_to                         String?         @db.Uuid
  scheduled_start                     DateTime?       @db.Timestamp(6)
  scheduled_end                       DateTime?       @db.Timestamp(6)
  actual_start                        DateTime?       @db.Timestamp(6)
  actual_end                          DateTime?       @db.Timestamp(6)
  duration                            Int?
  status                              String?         @default("planned") @db.VarChar(50)
  priority                            priority_level? @default(medium)
  outcome                             String?
  location                            String?         @db.VarChar(255)
  attendees                           Json?
  reminder_minutes                    Int?
  created_at                          DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                          DateTime?       @default(now()) @db.Timestamp(6)
  created_by                          String?         @db.Uuid
  users_activities_assigned_toTousers users?          @relation("activities_assigned_toTousers", fields: [assigned_to], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_activities_created_byTousers  users?          @relation("activities_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_activities_owner_idTousers    users           @relation("activities_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([assigned_to], map: "idx_activities_assigned")
  @@index([owner_id], map: "idx_activities_owner")
  @@index([related_to_type, related_to_id], map: "idx_activities_related")
  @@index([scheduled_start], map: "idx_activities_scheduled")
  @@index([status], map: "idx_activities_status")
  @@index([activity_type], map: "idx_activities_type")
}

model attachments {
  id              String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  file_name       String    @db.VarChar(255)
  file_path       String
  file_size       BigInt?
  mime_type       String?   @db.VarChar(100)
  related_to_type String    @db.VarChar(50)
  related_to_id   String    @db.Uuid
  description     String?
  uploaded_by     String    @db.Uuid
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  users           users     @relation(fields: [uploaded_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([related_to_type, related_to_id], map: "idx_attachments_related")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model audit_logs {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String?   @db.Uuid
  action        String    @db.VarChar(100)
  resource_type String?   @db.VarChar(50)
  resource_id   String?   @db.Uuid
  old_values    Json?
  new_values    Json?
  metadata      Json?
  ip_address    String?   @db.VarChar(45)
  user_agent    String?
  status        String?   @default("success") @db.VarChar(20)
  error_message String?
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  users         users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([action], map: "idx_audit_logs_action")
  @@index([created_at(sort: Desc)], map: "idx_audit_logs_created_at")
  @@index([resource_type, resource_id], map: "idx_audit_logs_resource")
  @@index([user_id], map: "idx_audit_logs_user_id")
}

model campaign_members {
  id             String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  campaign_id    String    @db.Uuid
  member_type    String    @db.VarChar(50)
  member_id      String    @db.Uuid
  status         String?   @default("sent") @db.VarChar(50)
  sent_at        DateTime? @db.Timestamp(6)
  opened_at      DateTime? @db.Timestamp(6)
  clicked_at     DateTime? @db.Timestamp(6)
  responded_at   DateTime? @db.Timestamp(6)
  response_notes String?
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  campaigns      campaigns @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([campaign_id, member_type, member_id])
  @@index([campaign_id], map: "idx_campaign_members_campaign")
  @@index([member_type, member_id], map: "idx_campaign_members_member")
}

model campaigns {
  id                                String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                              String             @db.VarChar(255)
  description                       String?
  campaign_type                     String?            @db.VarChar(50)
  status                            String?            @default("planning") @db.VarChar(50)
  budget_amount                     Decimal?           @db.Decimal(15, 2)
  actual_cost                       Decimal?           @default(0) @db.Decimal(15, 2)
  start_date                        DateTime?          @db.Date
  end_date                          DateTime?          @db.Date
  expected_response                 Int?
  expected_revenue                  Decimal?           @db.Decimal(15, 2)
  num_sent                          Int?               @default(0)
  num_delivered                     Int?               @default(0)
  num_opened                        Int?               @default(0)
  num_clicked                       Int?               @default(0)
  num_leads                         Int?               @default(0)
  num_converted                     Int?               @default(0)
  actual_revenue                    Decimal?           @default(0) @db.Decimal(15, 2)
  owner_id                          String             @db.Uuid
  created_at                        DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                        DateTime?          @default(now()) @db.Timestamp(6)
  created_by                        String?            @db.Uuid
  campaign_members                  campaign_members[]
  users_campaigns_created_byTousers users?             @relation("campaigns_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_campaigns_owner_idTousers   users              @relation("campaigns_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([start_date, end_date], map: "idx_campaigns_dates")
  @@index([status], map: "idx_campaigns_status")
}

model companies {
  id                                String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                              String          @db.VarChar(255)
  legal_name                        String?         @db.VarChar(255)
  tax_code                          String?         @unique @db.VarChar(50)
  website                           String?         @db.VarChar(255)
  industry                          String?         @db.VarChar(100)
  employee_count                    Int?
  annual_revenue                    Decimal?        @db.Decimal(15, 2)
  address_line1                     String?         @db.VarChar(255)
  address_line2                     String?         @db.VarChar(255)
  city                              String?         @db.VarChar(100)
  state                             String?         @db.VarChar(100)
  country                           String?         @db.VarChar(100)
  postal_code                       String?         @db.VarChar(20)
  phone                             String?         @db.VarChar(20)
  email                             String?         @db.VarChar(255)
  company_type                      String?         @db.VarChar(50)
  company_size                      String?         @db.VarChar(50)
  parent_company_id                 String?         @db.Uuid
  owner_id                          String          @db.Uuid
  lead_source                       lead_source?
  lifetime_value                    Decimal?        @default(0) @db.Decimal(15, 2)
  last_contact_date                 DateTime?       @db.Date
  next_followup_date                DateTime?       @db.Date
  is_active                         Boolean?        @default(true)
  created_at                        DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                        DateTime?       @default(now()) @db.Timestamp(6)
  created_by                        String?         @db.Uuid
  deleted_at                        DateTime?       @db.Timestamp(6)
  users_companies_created_byTousers users?          @relation("companies_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_companies_owner_idTousers   users           @relation("companies_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  companies                         companies?      @relation("companiesTocompanies", fields: [parent_company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_companies                   companies[]     @relation("companiesTocompanies")
  contacts                          contacts[]
  leads                             leads[]
  opportunities                     opportunities[]
  orders                            orders[]
  quotes                            quotes[]
  tickets                           tickets[]

  @@index([owner_id], map: "idx_companies_owner")
  @@index([parent_company_id], map: "idx_companies_parent")
  @@index([company_type], map: "idx_companies_type")
}

model contacts {
  id                               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  first_name                       String          @db.VarChar(100)
  last_name                        String          @db.VarChar(100)
  full_name                        String?         @default(dbgenerated("(((first_name)::text || ' '::text) || (last_name)::text)")) @db.VarChar(255)
  title                            String?         @db.VarChar(100)
  department                       String?         @db.VarChar(100)
  email                            String?         @db.VarChar(255)
  phone                            String?         @db.VarChar(20)
  mobile                           String?         @db.VarChar(20)
  company_id                       String?         @db.Uuid
  reports_to_id                    String?         @db.Uuid
  linkedin_url                     String?         @db.VarChar(255)
  facebook_url                     String?         @db.VarChar(255)
  twitter_handle                   String?         @db.VarChar(100)
  owner_id                         String          @db.Uuid
  lead_source                      lead_source?
  address_line1                    String?         @db.VarChar(255)
  address_line2                    String?         @db.VarChar(255)
  city                             String?         @db.VarChar(100)
  state                            String?         @db.VarChar(100)
  country                          String?         @db.VarChar(100)
  postal_code                      String?         @db.VarChar(20)
  last_contact_date                DateTime?       @db.Date
  next_followup_date               DateTime?       @db.Date
  is_primary                       Boolean?        @default(false)
  is_decision_maker                Boolean?        @default(false)
  do_not_call                      Boolean?        @default(false)
  do_not_email                     Boolean?        @default(false)
  is_active                        Boolean?        @default(true)
  created_at                       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                       DateTime?       @default(now()) @db.Timestamp(6)
  created_by                       String?         @db.Uuid
  deleted_at                       DateTime?       @db.Timestamp(6)
  companies                        companies?      @relation(fields: [company_id], references: [id], onUpdate: NoAction)
  users_contacts_created_byTousers users?          @relation("contacts_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_contacts_owner_idTousers   users           @relation("contacts_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                         contacts?       @relation("contactsTocontacts", fields: [reports_to_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_contacts                   contacts[]      @relation("contactsTocontacts")
  leads                            leads[]
  opportunities                    opportunities[]
  orders                           orders[]
  quotes                           quotes[]
  tickets                          tickets[]

  @@index([company_id], map: "idx_contacts_company")
  @@index([full_name], map: "idx_contacts_full_name")
  @@index([owner_id], map: "idx_contacts_owner")
}

model custom_field_values {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  custom_field_id String        @db.Uuid
  entity_type     String        @db.VarChar(50)
  entity_id       String        @db.Uuid
  value           String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  updated_at      DateTime?     @default(now()) @db.Timestamp(6)
  custom_fields   custom_fields @relation(fields: [custom_field_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([custom_field_id, entity_type, entity_id])
  @@index([entity_type, entity_id], map: "idx_custom_field_values_entity")
  @@index([custom_field_id], map: "idx_custom_field_values_field")
}

model custom_fields {
  id                  String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  entity_type         String                @db.VarChar(50)
  field_name          String                @db.VarChar(100)
  field_label         String                @db.VarChar(100)
  field_type          String                @db.VarChar(50)
  field_options       Json?
  is_required         Boolean?              @default(false)
  default_value       String?
  sort_order          Int?                  @default(0)
  is_active           Boolean?              @default(true)
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  created_by          String?               @db.Uuid
  custom_field_values custom_field_values[]
  users               users?                @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([entity_type, field_name])
  @@index([entity_type], map: "idx_custom_fields_entity")
}

model email_verification_tokens {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String    @db.Uuid
  token_hash String    @unique @db.VarChar(255)
  email      String    @db.VarChar(255)
  is_used    Boolean?  @default(false)
  used_at    DateTime? @db.Timestamp(6)
  expires_at DateTime  @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model emails {
  id                             String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  subject                        String    @db.VarChar(500)
  body                           String?
  from_address                   String    @db.VarChar(255)
  to_addresses                   String[]
  cc_addresses                   String[]
  bcc_addresses                  String[]
  related_to_type                String?   @db.VarChar(50)
  related_to_id                  String?   @db.Uuid
  status                         String?   @default("draft") @db.VarChar(50)
  sent_at                        DateTime? @db.Timestamp(6)
  delivered_at                   DateTime? @db.Timestamp(6)
  opened_at                      DateTime? @db.Timestamp(6)
  clicked_at                     DateTime? @db.Timestamp(6)
  bounced_at                     DateTime? @db.Timestamp(6)
  open_count                     Int?      @default(0)
  click_count                    Int?      @default(0)
  message_id                     String?   @db.VarChar(255)
  thread_id                      String?   @db.VarChar(255)
  owner_id                       String?   @db.Uuid
  created_at                     DateTime? @default(now()) @db.Timestamp(6)
  created_by                     String?   @db.Uuid
  users_emails_created_byTousers users?    @relation("emails_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_emails_owner_idTousers   users?    @relation("emails_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([related_to_type, related_to_id], map: "idx_emails_related")
  @@index([sent_at(sort: Desc)], map: "idx_emails_sent")
  @@index([status], map: "idx_emails_status")
}

model leads {
  id                            String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  first_name                    String?        @db.VarChar(100)
  last_name                     String?        @db.VarChar(100)
  company_name                  String?        @db.VarChar(255)
  title                         String?        @db.VarChar(100)
  email                         String?        @db.VarChar(255)
  phone                         String?        @db.VarChar(20)
  lead_source                   lead_source
  lead_status                   lead_status?   @default(new)
  lead_score                    Int?           @default(0)
  address_line1                 String?        @db.VarChar(255)
  city                          String?        @db.VarChar(100)
  state                         String?        @db.VarChar(100)
  country                       String?        @db.VarChar(100)
  postal_code                   String?        @db.VarChar(20)
  industry                      String?        @db.VarChar(100)
  employee_count                Int?
  annual_revenue                Decimal?       @db.Decimal(15, 2)
  owner_id                      String         @db.Uuid
  converted_at                  DateTime?      @db.Timestamp(6)
  converted_to_contact_id       String?        @db.Uuid
  converted_to_company_id       String?        @db.Uuid
  converted_to_opportunity_id   String?        @db.Uuid
  description                   String?
  created_at                    DateTime?      @default(now()) @db.Timestamp(6)
  updated_at                    DateTime?      @default(now()) @db.Timestamp(6)
  created_by                    String?        @db.Uuid
  deleted_at                    DateTime?      @db.Timestamp(6)
  opportunities                 opportunities? @relation(fields: [converted_to_opportunity_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_leads_opportunity")
  companies                     companies?     @relation(fields: [converted_to_company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                      contacts?      @relation(fields: [converted_to_contact_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_leads_created_byTousers users?         @relation("leads_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_leads_owner_idTousers   users          @relation("leads_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([converted_at, converted_to_contact_id], map: "idx_leads_converted")
  @@index([owner_id], map: "idx_leads_owner")
  @@index([lead_source], map: "idx_leads_source")
  @@index([lead_status], map: "idx_leads_status")
}

model notes {
  id              String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title           String?   @db.VarChar(255)
  content         String
  related_to_type String    @db.VarChar(50)
  related_to_id   String    @db.Uuid
  is_private      Boolean?  @default(false)
  created_by      String    @db.Uuid
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)
  users           users     @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_by], map: "idx_notes_author")
  @@index([related_to_type, related_to_id], map: "idx_notes_related")
}

model opportunities {
  id                                    String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                                  String             @db.VarChar(255)
  description                           String?
  company_id                            String?            @db.Uuid
  contact_id                            String?            @db.Uuid
  stage                                 opportunity_stage? @default(prospecting)
  probability                           Int?               @default(0)
  amount                                Decimal            @db.Decimal(15, 2)
  expected_revenue                      Decimal?           @default(dbgenerated("((amount * (probability)::numeric) / 100.0)")) @db.Decimal(15, 2)
  expected_close_date                   DateTime?          @db.Date
  actual_close_date                     DateTime?          @db.Date
  owner_id                              String             @db.Uuid
  lead_source                           lead_source?
  next_step                             String?
  loss_reason                           String?
  is_closed                             Boolean?           @default(false)
  is_won                                Boolean?           @default(false)
  created_at                            DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                            DateTime?          @default(now()) @db.Timestamp(6)
  created_by                            String?            @db.Uuid
  deleted_at                            DateTime?          @db.Timestamp(6)
  leads                                 leads[]
  companies                             companies?         @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                              contacts?          @relation(fields: [contact_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_opportunities_created_byTousers users?             @relation("opportunities_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_opportunities_owner_idTousers   users              @relation("opportunities_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                orders[]
  quotes                                quotes[]

  @@index([amount], map: "idx_opportunities_amount")
  @@index([expected_close_date], map: "idx_opportunities_close_date")
  @@index([company_id], map: "idx_opportunities_company")
  @@index([contact_id], map: "idx_opportunities_contact")
  @@index([owner_id], map: "idx_opportunities_owner")
  @@index([stage], map: "idx_opportunities_stage")
}

model order_items {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_id         String    @db.Uuid
  product_id       String?   @db.Uuid
  product_name     String    @db.VarChar(255)
  product_code     String?   @db.VarChar(100)
  quantity         Decimal   @db.Decimal(10, 2)
  unit_price       Decimal   @db.Decimal(15, 2)
  discount_percent Decimal?  @default(0) @db.Decimal(5, 2)
  tax_rate         Decimal?  @default(0) @db.Decimal(5, 2)
  line_total       Decimal?  @default(dbgenerated("(((quantity * unit_price) * ((1)::numeric - (discount_percent / 100.0))) * ((1)::numeric + (tax_rate / 100.0)))")) @db.Decimal(15, 2)
  sort_order       Int?      @default(0)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  orders           orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products         products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id                                          String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_number                                String          @unique @db.VarChar(50)
  quote_id                                    String?         @db.Uuid
  opportunity_id                              String?         @db.Uuid
  company_id                                  String?         @db.Uuid
  contact_id                                  String?         @db.Uuid
  order_date                                  DateTime        @default(dbgenerated("CURRENT_DATE")) @db.Date
  subtotal                                    Decimal?        @default(0) @db.Decimal(15, 2)
  discount_amount                             Decimal?        @default(0) @db.Decimal(15, 2)
  tax_amount                                  Decimal?        @default(0) @db.Decimal(15, 2)
  shipping_cost                               Decimal?        @default(0) @db.Decimal(15, 2)
  total_amount                                Decimal?        @default(0) @db.Decimal(15, 2)
  payment_method                              payment_method?
  payment_status                              String?         @default("pending") @db.VarChar(50)
  paid_amount                                 Decimal?        @default(0) @db.Decimal(15, 2)
  status                                      order_status?   @default(pending)
  shipping_address                            String?
  tracking_number                             String?         @db.VarChar(100)
  shipped_date                                DateTime?       @db.Date
  delivered_date                              DateTime?       @db.Date
  owner_id                                    String          @db.Uuid
  notes                                       String?
  created_at                                  DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                                  DateTime?       @default(now()) @db.Timestamp(6)
  created_by                                  String?         @db.Uuid
  order_items                                 order_items[]
  companies                                   companies?      @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                                    contacts?       @relation(fields: [contact_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_orders_created_byTousers              users?          @relation("orders_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  opportunities                               opportunities?  @relation(fields: [opportunity_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_orders_owner_idTousers                users           @relation("orders_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quotes_orders_quote_idToquotes              quotes?         @relation("orders_quote_idToquotes", fields: [quote_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quotes_quotes_converted_to_order_idToorders quotes[]        @relation("quotes_converted_to_order_idToorders")
  tickets                                     tickets[]

  @@index([company_id], map: "idx_orders_company")
  @@index([order_date(sort: Desc)], map: "idx_orders_date")
  @@index([order_number], map: "idx_orders_number")
  @@index([owner_id], map: "idx_orders_owner")
  @@index([status], map: "idx_orders_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model password_reset_tokens {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String    @db.Uuid
  token_hash String    @unique @db.VarChar(255)
  is_used    Boolean?  @default(false)
  used_at    DateTime? @db.Timestamp(6)
  expires_at DateTime  @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_password_reset_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model permissions {
  id               String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name             String             @unique @db.VarChar(100)
  description      String?
  resource         String             @db.VarChar(50)
  action           String             @db.VarChar(20)
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  role_permissions role_permissions[]
  user_permissions user_permissions[]
}

model pipeline_stages {
  id              String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  pipeline_id     String          @db.Uuid
  name            String          @db.VarChar(100)
  probability     Int?            @default(0)
  sort_order      Int?            @default(0)
  is_closed       Boolean?        @default(false)
  is_won          Boolean?        @default(false)
  created_at      DateTime?       @default(now()) @db.Timestamp(6)
  sales_pipelines sales_pipelines @relation(fields: [pipeline_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model products {
  id                String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String        @db.VarChar(255)
  code              String        @unique @db.VarChar(100)
  description       String?
  category          String?       @db.VarChar(100)
  product_family    String?       @db.VarChar(100)
  unit_price        Decimal       @db.Decimal(15, 2)
  cost_price        Decimal?      @db.Decimal(15, 2)
  currency          String?       @default("VND") @db.VarChar(3)
  quantity_in_stock Int?          @default(0)
  reorder_level     Int?          @default(0)
  tax_rate          Decimal?      @default(0) @db.Decimal(5, 2)
  is_active         Boolean?      @default(true)
  is_taxable        Boolean?      @default(true)
  created_at        DateTime?     @default(now()) @db.Timestamp(6)
  updated_at        DateTime?     @default(now()) @db.Timestamp(6)
  created_by        String?       @db.Uuid
  order_items       order_items[]
  users             users?        @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quote_items       quote_items[]

  @@index([category], map: "idx_products_category")
  @@index([code], map: "idx_products_code")
}

model quote_items {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  quote_id         String    @db.Uuid
  product_id       String?   @db.Uuid
  product_name     String    @db.VarChar(255)
  product_code     String?   @db.VarChar(100)
  description      String?
  quantity         Decimal   @db.Decimal(10, 2)
  unit_price       Decimal   @db.Decimal(15, 2)
  discount_percent Decimal?  @default(0) @db.Decimal(5, 2)
  tax_rate         Decimal?  @default(0) @db.Decimal(5, 2)
  line_total       Decimal?  @default(dbgenerated("(((quantity * unit_price) * ((1)::numeric - (discount_percent / 100.0))) * ((1)::numeric + (tax_rate / 100.0)))")) @db.Decimal(15, 2)
  sort_order       Int?      @default(0)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  products         products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  quotes           quotes    @relation(fields: [quote_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model quotes {
  id                                          String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  quote_number                                String         @unique @db.VarChar(50)
  opportunity_id                              String?        @db.Uuid
  company_id                                  String?        @db.Uuid
  contact_id                                  String?        @db.Uuid
  name                                        String         @db.VarChar(255)
  description                                 String?
  subtotal                                    Decimal?       @default(0) @db.Decimal(15, 2)
  discount_amount                             Decimal?       @default(0) @db.Decimal(15, 2)
  discount_percent                            Decimal?       @default(0) @db.Decimal(5, 2)
  tax_amount                                  Decimal?       @default(0) @db.Decimal(15, 2)
  shipping_cost                               Decimal?       @default(0) @db.Decimal(15, 2)
  total_amount                                Decimal?       @default(0) @db.Decimal(15, 2)
  quote_date                                  DateTime       @default(dbgenerated("CURRENT_DATE")) @db.Date
  expiry_date                                 DateTime?      @db.Date
  status                                      String?        @default("draft") @db.VarChar(50)
  owner_id                                    String         @db.Uuid
  payment_terms                               String?
  shipping_terms                              String?
  notes                                       String?
  converted_to_order_id                       String?        @db.Uuid
  converted_at                                DateTime?      @db.Timestamp(6)
  created_at                                  DateTime?      @default(now()) @db.Timestamp(6)
  updated_at                                  DateTime?      @default(now()) @db.Timestamp(6)
  created_by                                  String?        @db.Uuid
  orders_orders_quote_idToquotes              orders[]       @relation("orders_quote_idToquotes")
  quote_items                                 quote_items[]
  orders_quotes_converted_to_order_idToorders orders?        @relation("quotes_converted_to_order_idToorders", fields: [converted_to_order_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_quotes_order")
  companies                                   companies?     @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                                    contacts?      @relation(fields: [contact_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_quotes_created_byTousers              users?         @relation("quotes_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  opportunities                               opportunities? @relation(fields: [opportunity_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_quotes_owner_idTousers                users          @relation("quotes_owner_idTousers", fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rate_limits {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  identifier       String    @db.VarChar(255)
  action           String    @db.VarChar(50)
  attempt_count    Int?      @default(1)
  first_attempt_at DateTime? @default(now()) @db.Timestamp(6)
  last_attempt_at  DateTime? @default(now()) @db.Timestamp(6)
  is_blocked       Boolean?  @default(false)
  blocked_until    DateTime? @db.Timestamp(6)

  @@unique([identifier, action])
  @@index([is_blocked, blocked_until], map: "idx_rate_limits_blocked")
  @@index([identifier, action], map: "idx_rate_limits_identifier")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model refresh_tokens {
  id                   String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id              String           @db.Uuid
  session_id           String?          @db.Uuid
  token_hash           String           @unique @db.VarChar(255)
  token_family         String           @db.Uuid
  parent_token_id      String?          @db.Uuid
  is_revoked           Boolean?         @default(false)
  revoked_at           DateTime?        @db.Timestamp(6)
  revoked_reason       String?
  expires_at           DateTime         @db.Timestamp(6)
  created_at           DateTime?        @default(now()) @db.Timestamp(6)
  used_at              DateTime?        @db.Timestamp(6)
  refresh_tokens       refresh_tokens?  @relation("refresh_tokensTorefresh_tokens", fields: [parent_token_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_refresh_tokens refresh_tokens[] @relation("refresh_tokensTorefresh_tokens")
  sessions             sessions?        @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([token_family], map: "idx_refresh_tokens_family")
  @@index([user_id], map: "idx_refresh_tokens_user_id")
}

model role_permissions {
  role_id       String      @db.Uuid
  permission_id String      @db.Uuid
  granted_at    DateTime?   @default(now()) @db.Timestamp(6)
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([role_id, permission_id])
  @@index([permission_id], map: "idx_role_permissions_permission")
  @@index([role_id], map: "idx_role_permissions_role")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model roles {
  id               String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name             String             @unique @db.VarChar(50)
  description      String?
  is_system        Boolean?           @default(false)
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @db.Timestamp(6)
  role_permissions role_permissions[]
  users            users[]
}

model sales_pipelines {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name            String            @db.VarChar(100)
  description     String?
  is_default      Boolean?          @default(false)
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  created_by      String?           @db.Uuid
  pipeline_stages pipeline_stages[]
  users           users?            @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sessions {
  id               String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id          String           @db.Uuid
  session_token    String           @unique @db.VarChar(255)
  user_agent       String?
  ip_address       String?          @db.VarChar(45)
  device_type      String?          @db.VarChar(50)
  is_valid         Boolean?         @default(true)
  expires_at       DateTime         @db.Timestamp(6)
  created_at       DateTime?        @default(now()) @db.Timestamp(6)
  last_activity_at DateTime?        @default(now()) @db.Timestamp(6)
  refresh_tokens   refresh_tokens[]
  users            users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model taggables {
  tag_id        String    @db.Uuid
  taggable_type String    @db.VarChar(50)
  taggable_id   String    @db.Uuid
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  created_by    String?   @db.Uuid
  users         users?    @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tags          tags      @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([tag_id, taggable_type, taggable_id])
  @@index([taggable_type, taggable_id], map: "idx_taggables_entity")
  @@index([tag_id], map: "idx_taggables_tag")
}

model tags {
  id          String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String      @unique @db.VarChar(100)
  color       String?     @db.VarChar(7)
  description String?
  created_at  DateTime?   @default(now()) @db.Timestamp(6)
  created_by  String?     @db.Uuid
  taggables   taggables[]
  users       users?      @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model ticket_comments {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ticket_id   String    @db.Uuid
  comment     String
  user_id     String?   @db.Uuid
  is_internal Boolean?  @default(false)
  is_solution Boolean?  @default(false)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
  tickets     tickets   @relation(fields: [ticket_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model tickets {
  id                               String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ticket_number                    String            @unique @db.VarChar(50)
  subject                          String            @db.VarChar(255)
  description                      String
  company_id                       String?           @db.Uuid
  contact_id                       String?           @db.Uuid
  category                         String?           @db.VarChar(100)
  subcategory                      String?           @db.VarChar(100)
  priority                         priority_level?   @default(medium)
  status                           ticket_status?    @default(open)
  assigned_to                      String?           @db.Uuid
  assigned_team                    String?           @db.VarChar(100)
  sla_due_date                     DateTime?         @db.Timestamp(6)
  first_response_at                DateTime?         @db.Timestamp(6)
  resolved_at                      DateTime?         @db.Timestamp(6)
  closed_at                        DateTime?         @db.Timestamp(6)
  response_time_minutes            Int?
  resolution_time_minutes          Int?
  related_to_order_id              String?           @db.Uuid
  parent_ticket_id                 String?           @db.Uuid
  satisfaction_rating              Int?
  satisfaction_comment             String?
  created_at                       DateTime?         @default(now()) @db.Timestamp(6)
  updated_at                       DateTime?         @default(now()) @db.Timestamp(6)
  created_by                       String?           @db.Uuid
  ticket_comments                  ticket_comments[]
  users_tickets_assigned_toTousers users?            @relation("tickets_assigned_toTousers", fields: [assigned_to], references: [id], onDelete: NoAction, onUpdate: NoAction)
  companies                        companies?        @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  contacts                         contacts?         @relation(fields: [contact_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_tickets_created_byTousers  users?            @relation("tickets_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tickets                          tickets?          @relation("ticketsTotickets", fields: [parent_ticket_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_tickets                    tickets[]         @relation("ticketsTotickets")
  orders                           orders?           @relation(fields: [related_to_order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([assigned_to], map: "idx_tickets_assigned")
  @@index([company_id], map: "idx_tickets_company")
  @@index([contact_id], map: "idx_tickets_contact")
  @@index([ticket_number], map: "idx_tickets_number")
  @@index([priority, status], map: "idx_tickets_priority")
  @@index([status], map: "idx_tickets_status")
}

model user_permissions {
  user_id                                  String      @db.Uuid
  permission_id                            String      @db.Uuid
  is_granted                               Boolean?    @default(true)
  granted_by                               String?     @db.Uuid
  granted_at                               DateTime?   @default(now()) @db.Timestamp(6)
  expires_at                               DateTime?   @db.Timestamp(6)
  users_user_permissions_granted_byTousers users?      @relation("user_permissions_granted_byTousers", fields: [granted_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  permissions                              permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_user_permissions_user_idTousers    users       @relation("user_permissions_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, permission_id])
  @@index([user_id], map: "idx_user_permissions_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id                                                  String                      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email                                               String                      @unique @db.VarChar(255)
  username                                            String                      @unique @db.VarChar(50)
  password_hash                                       String                      @db.VarChar(255)
  full_name                                           String?                     @db.VarChar(100)
  avatar_url                                          String?
  phone                                               String?                     @db.VarChar(20)
  is_email_verified                                   Boolean?                    @default(false)
  email_verified_at                                   DateTime?                   @db.Timestamp(6)
  is_active                                           Boolean?                    @default(true)
  is_locked                                           Boolean?                    @default(false)
  locked_reason                                       String?
  locked_at                                           DateTime?                   @db.Timestamp(6)
  failed_login_attempts                               Int?                        @default(0)
  last_failed_login_at                                DateTime?                   @db.Timestamp(6)
  last_login_at                                       DateTime?                   @db.Timestamp(6)
  last_login_ip                                       String?                     @db.VarChar(45)
  role_id                                             String                      @db.Uuid
  created_at                                          DateTime?                   @default(now()) @db.Timestamp(6)
  updated_at                                          DateTime?                   @default(now()) @db.Timestamp(6)
  deleted_at                                          DateTime?                   @db.Timestamp(6)
  activities_activities_assigned_toTousers            activities[]                @relation("activities_assigned_toTousers")
  activities_activities_created_byTousers             activities[]                @relation("activities_created_byTousers")
  activities_activities_owner_idTousers               activities[]                @relation("activities_owner_idTousers")
  attachments                                         attachments[]
  audit_logs                                          audit_logs[]
  campaigns_campaigns_created_byTousers               campaigns[]                 @relation("campaigns_created_byTousers")
  campaigns_campaigns_owner_idTousers                 campaigns[]                 @relation("campaigns_owner_idTousers")
  companies_companies_created_byTousers               companies[]                 @relation("companies_created_byTousers")
  companies_companies_owner_idTousers                 companies[]                 @relation("companies_owner_idTousers")
  contacts_contacts_created_byTousers                 contacts[]                  @relation("contacts_created_byTousers")
  contacts_contacts_owner_idTousers                   contacts[]                  @relation("contacts_owner_idTousers")
  custom_fields                                       custom_fields[]
  email_verification_tokens                           email_verification_tokens[]
  emails_emails_created_byTousers                     emails[]                    @relation("emails_created_byTousers")
  emails_emails_owner_idTousers                       emails[]                    @relation("emails_owner_idTousers")
  leads_leads_created_byTousers                       leads[]                     @relation("leads_created_byTousers")
  leads_leads_owner_idTousers                         leads[]                     @relation("leads_owner_idTousers")
  notes                                               notes[]
  opportunities_opportunities_created_byTousers       opportunities[]             @relation("opportunities_created_byTousers")
  opportunities_opportunities_owner_idTousers         opportunities[]             @relation("opportunities_owner_idTousers")
  orders_orders_created_byTousers                     orders[]                    @relation("orders_created_byTousers")
  orders_orders_owner_idTousers                       orders[]                    @relation("orders_owner_idTousers")
  password_reset_tokens                               password_reset_tokens[]
  products                                            products[]
  quotes_quotes_created_byTousers                     quotes[]                    @relation("quotes_created_byTousers")
  quotes_quotes_owner_idTousers                       quotes[]                    @relation("quotes_owner_idTousers")
  refresh_tokens                                      refresh_tokens[]
  sales_pipelines                                     sales_pipelines[]
  sessions                                            sessions[]
  taggables                                           taggables[]
  tags                                                tags[]
  ticket_comments                                     ticket_comments[]
  tickets_tickets_assigned_toTousers                  tickets[]                   @relation("tickets_assigned_toTousers")
  tickets_tickets_created_byTousers                   tickets[]                   @relation("tickets_created_byTousers")
  user_permissions_user_permissions_granted_byTousers user_permissions[]          @relation("user_permissions_granted_byTousers")
  user_permissions_user_permissions_user_idTousers    user_permissions[]          @relation("user_permissions_user_idTousers")
  roles                                               roles                       @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_users_created_at")
  @@index([role_id], map: "idx_users_role_id")
}

enum activity_type {
  call
  meeting
  email
  task
  note
  demo
  lunch
}

enum lead_source {
  website
  referral
  social_media
  email_campaign
  cold_call
  trade_show
  partner
  other
}

enum lead_status {
  new
  contacted
  qualified
  unqualified
  converted
}

enum opportunity_stage {
  prospecting
  qualification
  proposal
  negotiation
  closed_won
  closed_lost
}

enum order_status {
  draft
  pending
  confirmed
  processing
  shipped
  delivered
  cancelled
  refunded
}

enum payment_method {
  cash
  bank_transfer
  credit_card
  debit_card
  e_wallet
  check
}

enum priority_level {
  low
  medium
  high
  urgent
}

enum ticket_status {
  open
  in_progress
  pending
  resolved
  closed
  reopened
}
